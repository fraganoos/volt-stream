<Page
    x:Class="VoltStream.WPF.Turnovers.Views.TurnoversPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:VoltStream.WPF.Commons.UserControls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:utils="clr-namespace:VoltStream.WPF.Commons.Utils"
    Title="TurnoversPage"
    d:DesignHeight="450"
    d:DesignWidth="900"
    mc:Ignorable="d">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
        </Grid.RowDefinitions>

        <Grid Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <TextBlock
                VerticalAlignment="Center"
                FontSize="13"
                Text="Xisobot davri" />
            <StackPanel
                Grid.Column="1"
                Margin="10,0"
                Orientation="Horizontal">
                <controls:UserCalendar
                    Width="110"
                    FontSize="14"
                    SelectedDate="{Binding BeginDate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    utils:EnterKeyTab.IsEnabled="True" />
                <TextBlock
                    Margin="5,0"
                    VerticalAlignment="Center"
                    FontSize="13"
                    Text="dan" />
                <controls:UserCalendar
                    Width="110"
                    FontSize="14"
                    SelectedDate="{Binding EndDate, Mode=TwoWay, UpdateSourceTrigger=LostFocus}"
                    utils:EnterKeyTab.IsEnabled="True" />
                <TextBlock
                    Margin="5,0"
                    VerticalAlignment="Center"
                    FontSize="13"
                    Text="gacha" />
            </StackPanel>

            <TextBlock
                Grid.Row="1"
                Margin="0,5,0,0"
                VerticalAlignment="Center"
                FontSize="13"
                Text="Mijoz" />
            <ComboBox
                x:Name="cbxCustomer"
                Grid.Row="1"
                Grid.Column="1"
                Width="280"
                Margin="10,5,10,0"
                HorizontalAlignment="Left"
                DisplayMemberPath="Name"
                FontSize="14"
                IsEditable="True"
                ItemsSource="{Binding Customers}"
                SelectedItem="{Binding SelectedCustomer}" />

            <Button
                Grid.Column="2"
                Width="100"
                Command="{Binding PreviewCommand}"
                Content="ðŸ“„ Koâ€˜rish"
                FontSize="13" />
            <Button
                Grid.Row="1"
                Grid.Column="2"
                Width="100"
                Margin="0,5,0,0"
                Command="{Binding ClearFilterCommand}"
                Content="ðŸ§¹ Tozalash"
                FontSize="13" />

            <Button
                Grid.Column="3"
                Width="100"
                Margin="10,0"
                Command="{Binding PrintCommand}"
                Content="ðŸ–¨ Pechat"
                FontSize="13" />
            <Button
                Grid.Row="1"
                Grid.Column="3"
                Width="100"
                Margin="10,5,10,0"
                Command="{Binding ExportToExcelCommand}"
                Content="ðŸ“Š Excel"
                FontSize="13" />

            <TextBlock
                Grid.Column="4"
                Margin="20,0,10,0"
                VerticalAlignment="Center"
                FontSize="14"
                Text="Boshlang'ich qoldiq:" />
            <TextBlock
                Grid.Column="5"
                VerticalAlignment="Center"
                FontSize="14"
                FontWeight="SemiBold"
                Text="{Binding BeginBalance, StringFormat={}{0:N2}}" />

            <TextBlock
                Grid.Row="1"
                Grid.Column="4"
                Margin="20,5,10,0"
                VerticalAlignment="Center"
                FontSize="14"
                Text="Oxirgi qoldiq:" />
            <TextBlock
                Grid.Row="1"
                Grid.Column="5"
                Margin="0,5,0,0"
                VerticalAlignment="Center"
                FontSize="14"
                FontWeight="SemiBold"
                Text="{Binding LastBalance, StringFormat={}{0:N2}}" />
        </Grid>

        <DataGrid
            x:Name="MyDataGrid"
            Grid.Row="1"
            AlternatingRowBackground="#F5F5F5"
            AutoGenerateColumns="False"
            CanUserAddRows="False"
            CanUserDeleteRows="False"
            FontSize="14"
            HeadersVisibility="Column, Row"
            IsReadOnly="True"
            ItemsSource="{Binding CustomerOperationsForDisplay}"
            SelectionMode="Single"
            utils:DataGridRowNumbering.IsEnabled="True">
            <DataGrid.Columns>
                <DataGridTextColumn
                    Width="0.7*"
                    Binding="{Binding Date, StringFormat={}{0:dd.MM.yyyy}}"
                    Header="Sana">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Padding" Value="5,0" />
                            <Setter Property="TextAlignment" Value="Center" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.HeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="HorizontalContentAlignment" Value="Center" />
                            <Setter Property="VerticalContentAlignment" Value="Center" />
                        </Style>
                    </DataGridTextColumn.HeaderStyle>
                </DataGridTextColumn>
                <DataGridTemplateColumn Width="3*">
                    <DataGridTemplateColumn.Header>
                        <TextBlock Text="Izoh" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold" />
                    </DataGridTemplateColumn.Header>
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ContentPresenter Content="{Binding FormattedTextBlock}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                    <DataGridTemplateColumn.HeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="HorizontalContentAlignment" Value="Center" />
                            <Setter Property="VerticalContentAlignment" Value="Center" />
                        </Style>
                    </DataGridTemplateColumn.HeaderStyle>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn Width="0.7*">
                    <DataGridTemplateColumn.HeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="HorizontalContentAlignment" Value="Center" />
                        </Style>
                    </DataGridTemplateColumn.HeaderStyle>
                    <DataGridTemplateColumn.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Debit" Foreground="DarkRed" FontWeight="Bold"/>
                            <TextBlock Text=" / " Foreground="Black" FontWeight="Bold"/>
                            <TextBlock Text="Kredit" Foreground="Black" FontWeight="Bold"/>
                        </StackPanel>
                    </DataGridTemplateColumn.Header>
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid Margin="5,0">
                                <TextBlock
                                    Text="{Binding Debit, StringFormat={}{0:N0}}"
                                    Foreground="DarkRed"
                                    HorizontalAlignment="Right">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Debit, Converter={x:Null}}" Value="0">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding OperationType}" Value="Sale">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Credit}" Value="0">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <TextBlock
                                    Text="{Binding Credit, StringFormat={}{0:N0}}"
                                    Foreground="Black"
                                    HorizontalAlignment="Right">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Debit}" Value="0">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn Width="100" Header="Amallar">
                    <DataGridTemplateColumn.HeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="FontWeight" Value="SemiBold" />
                            <Setter Property="HorizontalContentAlignment" Value="Center" />
                        </Style>
                    </DataGridTemplateColumn.HeaderStyle>
                    <DataGridTemplateColumn.CellStyle>
                        <Style TargetType="DataGridCell">
                            <Setter Property="Padding" Value="5" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="DataGridCell">
                                        <StackPanel
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Orientation="Horizontal">
                                            <Button
                                                Width="32"
                                                Height="28"
                                                Margin="2,0"
                                                Background="#FFB300"
                                                Command="{Binding DataContext.EditCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                CommandParameter="{Binding}"
                                                Foreground="White"
                                                IsEnabled="{Binding CanEdit}"
                                                ToolTip="Tahrirlash">
                                                <Path
                                                    Width="14"
                                                    Height="14"
                                                    Data="M3,17.25V21H6.75L17.81,9.94L14.06,6.19L3,17.25ZM20.71,7.04C21.1,6.65 21.1,6 20.71,5.61L18.37,3.29C17.98,2.9 17.33,2.9 16.94,3.29L15.12,5.12L18.87,8.87L20.71,7.04Z"
                                                    Fill="White"
                                                    Stretch="Uniform" />
                                            </Button>
                                            <Button
                                                Width="32"
                                                Height="28"
                                                Margin="2,0"
                                                Background="#E53935"
                                                Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                CommandParameter="{Binding}"
                                                Foreground="White"
                                                ToolTip="Oâ€˜chirish">
                                                <Path
                                                    Width="14"
                                                    Height="14"
                                                    Data="M6,19C6,20.1 6.9,21 8,21H16C17.1,21 18,20.1 18,19V7H6V19ZM19,4H15.5L14.5,3H9.5L8.5,4H5V6H19V4Z"
                                                    Fill="White"
                                                    Stretch="Uniform" />
                                            </Button>
                                        </StackPanel>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </DataGridTemplateColumn.CellStyle>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</Page>
